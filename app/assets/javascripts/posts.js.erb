var s;
$(document).ready(function () {

  // Initialising SNAP in the canvas div
  s = Snap("#canvas");

  // all input is pushed to this array
  var pressed = []

  // event: logging live text preview
    window.addEventListener('keydown', function(e) {

      console.log(e.key);
      console.log(e.keyCode);

      // TO DO: Expand delete functionality to coincide with indexOf value when arrow keys are used...
      if (e.keyCode === 46 || e.keyCode === 8) {
        pressed.pop();
        console.log(pressed);

        // TO DO: Render a new line when 'Enter' key is pressed
      // } else if (e.keyCode === 13){
      //   pressed.push("<br />");
      //   console.log(pressed);

      // removing fn keys from live text preview
      } else if (e.keyCode === 16 || e.keyCode === 17 || e.keyCode === 18 || e.keyCode === 91 || e.keyCode === 20 || e.keyCode === 9 || e.keyCode === 37 || e.keyCode === 38 || e.keyCode === 39 || e.keyCode === 40 || e.keyCode === 13) {
        console.log(e.key + " is invalid");
        return e.key;
      } else {
          pressed.push(e.key);
          console.log(pressed);
      }
        var liveText = pressed.join("");
        console.log(liveText);
        var $p = $(".live-text");
        $p.text(liveText);

        $(".live-text").val("");

        $("#text-preview").append($p);

    });


    // SNAP TESTING

    Mousetrap.bind('a b c d e', function() {
      console.log("Mousetrapped: konami");
      Snap.load('<%= image_path( "svg3.svg" ) %>', function( e ) {
        console.log(e);
        // console.log( e.node.outerHTML );
        var face = e.node.outerHTML;

        $("#canvas").append( face );
      });

    });

  function onSVGLoaded(data){
    s.append(data);
  }

    Mousetrap.bind('f g h', function() {
      console.log("Mousetrapped: konami");
      Snap.load('<%= image_path("svg3.svg") %>', function (f) {
        f.selectAll("path").attr({stroke: "#00ff00", class: "anims", id: "face", cx: 1000, cy: 400 });
        var g = f.select("g");
        s.append(g);
        g.drag();
        var path = g.select("path");
        var length = path.getTotalLength();
        console.log( length );
        path.attr({
          cx: 100,
          'stroke-dasharray': length, 'stroke-dashoffset': length
        });
        path.animate({
          cx: 400,
          stroke: "#ff0000",
          'stroke-dashoffset': '0'
        }, 2000, mina.easein);
      });
      // console.log(face);
      // face.attr({
      //   class: "anims",
      //   id: "face",
      //   x: 200,
      //   y: 400
      // });
      // face.animate({x:400}, 2000, mina.easein);
    });


    Mousetrap.bind("d space", function () {
      console.log("ends with d");
      var bigCircle = s.circle(350, 150, 10);
      bigCircle.attr({
        fill:'#0dd333',
        stroke: "#000",
        strokeWidth: 5,
        class: "anims",
        id: "bigCircle"
      });
      bigCircle.animate({r:40}, 2000, mina.bounce);
    });



    // Bind mousetrap to anything that would end a word
      // Get all of the text that the user has typed
        // Split it on all word boundaries
          // Run an animation for each one




    // heart easter egg - CHANGE THIS TO SVG
    Mousetrap.bind('< 3', function() { console.log("Mousetrapped: heart");
    var $heartImg = $("<img>");
    $heartImg.attr("src", "/assets/images/heart.png");
    $heartImg.addClass("heart animation");

    $("#canvas").append($heartImg);

    });


    // events: background color
    Mousetrap.bind('.', function() {
      console.log("Mousetrapped: color change");
      var bgColors = ["#FFF000", "#663399", "#6c6c6c", "#909090", "#000", "#000ccc"];
      var randomColor = bgColors[Math.floor(Math.random()*bgColors.length)];
      console.log(randomColor);
      $("#canvas").css({"backgroundColor": randomColor});
    });


    // TO DO: EASTER EGG
  //   Mousetrap.bind('w h e r e  y o u c o m e f r o m a n d w h e r e y o u g o n n a g o t h i s t i m e', function() {
  //   console.log("Play Tell Me Baby");
  // });
  //
  // if (pressed.join("") === "where you come from and where you gonna go this time") {
  //   console.log("Play Tell Me Baby");
  // }

    // note to self - THIS DOES NOT WORK:
    // Mousetrap.bind('fghi', function() { console.log("Mousetrapped: fghi"); });
});
